<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta name="robots" content="noindex">
  <script>var exports = {};</script>
  <script src="https://unpkg.com/vue@2"></script>
  <script src="https://unpkg.com/@tinymce/tinymce-vue@3.2.8/lib/browser/tinymce-vue.min.js"></script>
  <link rel="stylesheet" type="text/css" href="main.css" media="screen" />
</head>
<body>
  <div id="app">
    <div class="header">Veloplus Helper</div>
      <div class="blocks">
          <h1>Template</h1>
          <div>
             <span v-for="template, key in this.templates">
                <button class="ui button templates toggle" @click="activateTemplate(key)">{{ template.name }}</button>
             </span>   
          </div>
          <div>
             <span v-for="block in this.blocks">
                <button class="ui button blocks toggle" :class={active:block.active} @click="block.active = !block.active" v-html="block.name">{{ block.name }}</button>
             </span>   
              </div>
      </div>
      <div class="text-input">
          <div v-for="block,key in this.blocks">
            <div v-if="block.active">
              <div v-if="key == 'freestyle'">
                <editor 
                    v-model="block.content" 
                    api-key="ekjnhz7itvvgp05ree5d2azoz5hobav2pbtzrkvpe7h18rmp"
                    :init="tinymceConfig.freestyle"
                />
              </div>
              <div v-else>
                  <div>                
                  <editor 
                    :class="block.heading"
                    v-model="block.name" 
                    api-key="ekjnhz7itvvgp05ree5d2azoz5hobav2pbtzrkvpe7h18rmp"
                    :init="tinymceConfig.header"
                /> 
              </div><div>
                <editor 
                    v-model="block.content" 
                    api-key="ekjnhz7itvvgp05ree5d2azoz5hobav2pbtzrkvpe7h18rmp"
                    :init="tinymceConfig.standard"
                />
                </div>
            </div>
          </div>
        </div>
     </div>
      <div class="html-output" ><div>{{ htmlText }}</div>
        <button class="copy" @click="this.copyCode">Code Kopieren</button>
      </div>
      <div class="current" v-if=true>
        <div>
        <input type="text" class="product-number-input" @keyup.enter="getCurrentText" v-model="productNumber" placeholder="e.g. 33001234">
        <button class="load-text" @click="getCurrentText">Aktueller Text Laden</button>
        </div>
        <h2>{{ currentProduct }}</h2>
        <div class="current-text" v-html="this.currentText"></div>
      </div>
    </div>

  <script type="module">
    import tinyconfig_json from "./tinymce_config.json" assert { type: 'json' };

    var app = new Vue({

      el: '#app',
        components: {
        'editor': Editor 
        },
      data: {
        tinymceConfig: tinyconfig_json,
        currentText: '',
        currentProduct: '',
        productNumber: '',
        product: { number: '', description: ''},
        templates: {
            basic: { name: 'Basic' },
            advanced: { name: 'Erweitert' },
            vpBrand: { name: 'Veloplus Eigenprodukte' },
            freestyle: { name: 'Freestyle' }
        },
        blocks: {
          nutshell: { active: false, name: "Auf den Punkt gebracht", content: 'Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et', heading: 'h2'},
          details: { active: false, name: "Wichtige Eigenschaften", content: 'Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate', heading: 'h2'},
          specs: { active: false, name: "Weitere Informationen", content: '', heading: 'h3'},
          inTheBox: { active: false, name: "Lieferumfang", content: '', heading: 'h3'},
          review: { active: false, name: "Das meint Veloplus", content: '', heading: 'h2'},
          freestyle: {active: false, name: "Freitext", content: 'Lorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim. Donec pede justo, fringilla vel, aliquet nec, vulputate', heading: ''}
        },
      },
  computed: {
    htmlText: function () {
      let html = '';
      for(const text in this.blocks) {
        if(this.blocks[text].content && this.blocks[text].active) {
          if(text == 'freestyle'){
            html = html + '<p>' + `${this.blocks[text].content}` + '</p><br>';
          } else {
            html = html + '<'+ `${this.blocks[text].heading}` + '>' + `${this.blocks[text].name}` + '</'+ `${this.blocks[text].heading}` + '><p>' + `${this.blocks[text].content}` + '</p><br>';
          }
        }
      }
      return html;
    },
  },
  methods: {
      copyCode: function(event) {
        event.currentTarget.innerHTML = "ist Kopiert!";
        navigator.clipboard.writeText(this.htmlText);
      },
      getCurrentText: async function() {
        console.log(this.productNumber);
        return await fetch('https://api.veloplus.ch/graphql', {
          method: 'POST',
          headers: {
              'Accept-Encoding': 'gzip, deflate, br',
              'Content-Type': 'application/json',
              'Accept': 'application/json',
              'Connection': 'keep-alive',
              'DNT': '1',
              'Origin': 'https://api.veloplus.ch'
          },
          body: JSON.stringify({
              'query': ' { product(productId: ' + this.productNumber + ') { texts {title description}}}'
      })
      })
      .then(response => response.json())
      .then((data) => { this.currentText = data.data.product.texts.description; this.currentProduct = data.data.product.texts.title});
      },
      activateTemplate: function(template) {
          if(template == 'basic') {
              this.blocks.nutshell.active = true;
              this.blocks.details.active = true;
              this.blocks.specs.active = false;
              this.blocks.inTheBox.active = false;
              this.blocks.review.active = false;
              this.blocks.freestyle.active = false;

          }
          if(template == 'advanced') {
              this.blocks.nutshell.active = true;
              this.blocks.details.active = true;
              this.blocks.specs.active = true;
              this.blocks.inTheBox.active = true;
              this.blocks.review.active = true;
              this.blocks.freestyle.active = false;

          }
          if(template == 'vpBrand') {
              this.blocks.nutshell.active = false;
              this.blocks.details.active = true;
              this.blocks.review.active = false;
              this.blocks.specs.active = true;
              this.blocks.inTheBox.active = true;
              this.blocks.freestyle.active = false;

          }
          if(template == 'freestyle') {
              this.blocks.nutshell.active = false;
              this.blocks.details.active = false;
              this.blocks.review.active = false;
              this.blocks.specs.active = false;
              this.blocks.inTheBox.active = false;
              this.blocks.freestyle.active = true;
          }
      }
  }
  }
    )
  </script>
</body>
</html>