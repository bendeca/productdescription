<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta name="robots" content="noindex">
  <script>var exports = {};</script>
  <script src="https://unpkg.com/vue@2"></script>
  <script src="https://unpkg.com/@tinymce/tinymce-vue@3.2.8/lib/browser/tinymce-vue.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="main.css" media="screen" />
</head>
<body>
  <div id="app">
    <div class="header">Marketingtext Editor</div>
      <div class="blocks">
          <div>
            <p>Templates</p>
             <span v-for="template, key in this.templates">
                <button class="ui button templates toggle" @click="activateTemplate(key)">{{ template.name }}</button>
             </span>   
             <span>
                | <button class="ui button toggle" @click="resetContent()"><i class="ri-delete-bin-line"></i> Text Löschen</button>
                <button class="ui button toggle save" @click="saveContent()" v-if=false><i class="ri-download-line"></i> Text lokal Speichern</button>
             </span>   
          </div>
          <div>
            <p style="margin-top: 50px;">Text-Blöcke</p>
             <span v-for="block in this.blocks">
                <button class="ui button blocks toggle" :class={active:block.active} @click="block.active = !block.active" v-html="block.name">{{ block.name }}</button>
             </span>   
              </div>
      </div>
      <div class="text-input">
          <div v-for="block,key in this.blocks">
            <div v-if="block.active">
              <div v-if="key == 'freestyle'">
                <editor 
                    v-model="block.content" 
                    api-key="ekjnhz7itvvgp05ree5d2azoz5hobav2pbtzrkvpe7h18rmp"
                    :init="tinymceConfig.freestyle"
                />
              </div>
              <div v-else>
                  <div>                
                  <editor 
                    :class="block.heading"
                    v-model="block.name" 
                    api-key="ekjnhz7itvvgp05ree5d2azoz5hobav2pbtzrkvpe7h18rmp"
                    :init="tinymceConfig.header"
                /> 
              </div><div>
                <editor 
                    v-model="block.content" 
                    api-key="ekjnhz7itvvgp05ree5d2azoz5hobav2pbtzrkvpe7h18rmp"
                    :init="tinymceConfig.standard"
                />
                </div>
            </div>
          </div>
        </div>
     </div>
      <div class="html-output" ><div>{{ htmlText }}</div>
        <button class="copy" @click="this.copyCode">Code Kopieren</button>
      </div>
      <div class="load-product">
        <span>Produktnummer Eingeben: </span>
        <input type="text" class="product-number-input" @keyup.enter="getCurrentText" v-model="productNumber" placeholder="e.g. 33001234">
        <button class="load-text" @click="getCurrentText">Aktuellen Text Laden [Enter]</button>
      </div>
      <div class="current">
        <h2>{{ currentProduct }}</h2>
        <div class="current-text" v-html="this.currentText"></div>
      </div>
      <div class="local-storage" v-if=false>
        <h1>gespeicherte Text</h1>
        <div class="saved-items">
          <div>Id</div>
          <div>Produktnummer</div>
          <div>Titel</div>
          <div>Text</div>
          <div>Laden</div>
          <div>Löschen</div>
        </div>
        <div class="saved-items" v-for="savedItem,index in savedItems">
          <div>{{ index }}</div>
          <div class="product-number">{{ savedItem[0] }}</div>
          <div>{{ savedItem[1] }}</div>
          <div>{{ savedItem[2] }}</div>
          <button class="load-text" @click="loadContent(savedItem[2])"><i class="ri-upload-line"></i> Laden</button>
          <button class="load-text" @click="deleteFromLocalStorage(index)"><i class="ri-delete-bin-line"></i> Eintrag Löschen</button>
        </div>
      </div>
    </div>
    <div id="explanation">
      <h2>Vorgaben und Erklärungen</h2>
      <h3>Allgemeine Vorgaben zu Sprache und Stil</h3>
      <p>
        <ul>
          <li>Am allerwichtigsten: Sich immer in die Situation der Kunden versetzen. Welche Informationen sind für den Kaufentscheid relevant? Was interessiert die Kunden an diesem Produkt mit Bezug zum Velo? Welche Informationen inspirieren die Kunden?</li>
<li>Texte möglichst kurz halten, indem auf unnötige Füllwörter verzichtet wird. Leute wollen nicht viel Fliesstext lesen.</li>
<li>Keine Lieferantentexte 1:1 kopieren! Unsere Texte sollen für die Suchmaschinenoptimierung einzigartig sein. Die Lieferantentexte sollen als Ausgangslage verwendet werden, müssen aber stark verändert werden. Ausnahme bei unwichtigen, kleinen Ersatzteilen.</li>
<li>Wenn man das Produkt selber getestet hat (oder internes Testfeedback hat), dann gerne auch die Erfahrung davon mit einfliessen lassen. Leser:in soll erkennen, dass das Produkt von Veloplus getestet wurde.</li>
<li>Keine direkte Ansprache der Kunden (“Sie können diesen Helm verwenden für…”) im Text sondern neutrale Formulierungen verwenden</li>
<li>Regeln zur Texterstellung werden von den Handbuch-Vorgaben übernommen (Abkürzungen, Kopplungen etc.)</li>
<br/>
<li><strong>Ergänzung für Eigenprodukte:</strong> Mehr Bilder, auführlichere Textbeschriebe, Entstehungsgeschickte, Verweis zu Videos, etc.</li>
        </ul>
      </p>
      <h3>Weiterführende Vorgaben und Anleitung im Detail</h3>
      <p><a target="_blank" href="https://drive.google.com/file/d/1ju-4vuKDtBkI3WSi16OJmzE_DWVpGfpM/view?usp=sharing">Dokument Vorgaben Texte Produkterfassung</a></p>
    </div>  

  <script type="module">
    import tinyconfig_json from "./tinymce_config.json" assert { type: 'json' };
    import templates_json from "./templates.json" assert { type: 'json' };
    
    var app = new Vue({

      el: '#app',
        components: {
        'editor': Editor 
        },
      data: {
        tinymceConfig: tinyconfig_json,
        currentText: '',
        currentProduct: '',
        productNumber: '',
        product: { number: '', description: ''},
        templates: {
            basic: { name: 'Basic' },
            advanced: { name: 'Erweitert' },
            //advancedSample: { name: 'Erweitert Beispiel' },
            freestyle: { name: 'Freestyle' }
        },
        blocks: JSON.parse(JSON.stringify(templates_json)),
        savedItems: '',
      },
  computed: {
    htmlText: function () {
      let html = '';
      for(const text in this.blocks) {
        if(this.blocks[text].content && this.blocks[text].active) {
          if(text == 'freestyle'){
            html = html + '<p>' + `${this.blocks[text].content}` + '</p><br>';
          } else {
            html = html + '<'+ `${this.blocks[text].heading}` + '>' + `${this.blocks[text].name}` + '</'+ `${this.blocks[text].heading}` + '><p>' + `${this.blocks[text].content}` + '</p><br>';
          }
        }
      }
      return html;
    },
  },
  mounted() {
    this.savedItems = localStorage.getItem("descriptions")
      ? JSON.parse(localStorage.getItem("descriptions"))
      : [];
  },
  methods: {
      copyCode: function(event) {
        event.currentTarget.innerHTML = "ist Kopiert!";
        navigator.clipboard.writeText(this.htmlText);
      },
      getCurrentText: async function() {
        console.log(this.productNumber);
        return await fetch('https://api.veloplus.ch/graphql', {
          method: 'POST',
          headers: {
              'Accept-Encoding': 'gzip, deflate, br',
              'Content-Type': 'application/json',
              'Accept': 'application/json',
              'Connection': 'keep-alive',
              'DNT': '1',
              'Origin': 'https://api.veloplus.ch'
          },
          body: JSON.stringify({
              'query': ' { product(productId: ' + this.productNumber + ') { texts {title description}}}'
      })
      })
      .then(response => response.json())
      .then((data) => { this.currentText = data.data.product.texts.description; this.currentProduct = data.data.product.texts.title});
      },
      resetContent: function() {
        this.blocks = JSON.parse(JSON.stringify(templates_json));
      },
      loadContent: function(content) {
        this.resetContent();
        this.activateTemplate('freestyle');
        this.blocks.freestyle.content = content;
      },
      deleteFromLocalStorage: function(index) {
        this.savedItems.splice(index, 1);
        localStorage.setItem("descriptions", JSON.stringify(this.savedItems));
      },
      saveContent: function() {
        this.savedItems.push([ this.productNumber, this.currentProduct, this.htmlText ]);
        localStorage.setItem("descriptions", JSON.stringify(this.savedItems));
        this.resetContent();
      },
      activateTemplate: function(template) {
          if(template == 'basic') {
              this.blocks.nutshell.active = true;
              this.blocks.details.active = true;
              this.blocks.specs.active = false;
              this.blocks.inTheBox.active = false;
              this.blocks.moreInfo.active = false;
              this.blocks.freestyle.active = false;

          }
          if(template == 'advanced') {
              this.blocks.nutshell.active = true;
              this.blocks.details.active = true;
              this.blocks.specs.active = true;
              this.blocks.inTheBox.active = true;
              this.blocks.moreInfo.active = true;
              this.blocks.freestyle.active = false;

          }

          if(template == 'freestyle') {
              this.blocks.nutshell.active = false;
              this.blocks.details.active = false;
              this.blocks.review.active = false;
              this.blocks.specs.active = false;
              this.blocks.inTheBox.active = false;
              this.blocks.moreInfo.active = false;
              this.blocks.freestyle.active = true;
          }
      }
  }
  }
    )
  </script>
</body>
</html>